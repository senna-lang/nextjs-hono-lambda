# システムパターン

## アーキテクチャ概要
このプロジェクトは、フロントエンドとバックエンドが明確に分離されたクライアント-サーバーアーキテクチャを採用しています。

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │      │                 │
│   Next.js       │──────▶   API Gateway   │──────▶   AWS Lambda    │
│   フロントエンド  │      │                 │      │   (Hono)        │
│                 │◀─────│                 │◀─────│                 │
└─────────────────┘      └─────────────────┘      └─────────────────┘
```

## 主要コンポーネント

### フロントエンド (Next.js)
- **ページコンポーネント**: アプリケーションのメインページ (`page.tsx`)
- **UIコンポーネント**: 再利用可能なコンポーネント（TodoForm, TodoList, TodoItem, ErrorMessage, LoadingIndicator, EmptyState）
- **カスタムフック**: データ取得と状態管理のためのフック（useTodos）
- **APIクライアント**: バックエンドとの通信を処理するHonoクライアント

### バックエンド (Hono + AWS Lambda)
- **APIルーティング**: RESTful APIエンドポイントの定義
- **データ検証**: Zodを使用したリクエストデータの検証
- **データストア**: メモリ内のMapを使用したTODOデータの一時保存
- **エラーハンドリング**: 適切なステータスコードとエラーメッセージを返す

### インフラストラクチャ (AWS CDK)
- **Lambda関数**: バックエンドコードを実行するサーバーレス環境
- **API Gateway**: HTTPリクエストをルーティングし、CORSを処理
- **Function URL**: Lambda関数への直接アクセスを提供

## 設計パターン

### フロントエンド
1. **コンポーネントベースアーキテクチャ**: UIを再利用可能なコンポーネントに分割
2. **カスタムフック**: ロジックを分離し、複数のコンポーネントで再利用可能にする
3. **宣言的UI**: Reactの宣言的アプローチを使用してUIを構築
4. **条件付きレンダリング**: ローディング状態、エラー状態、空の状態に応じて異なるUIを表示

### バックエンド
1. **RESTful API**: リソースベースのURLとHTTPメソッドを使用
2. **ミドルウェアパターン**: CORSやバリデーションをミドルウェアとして実装
3. **イミュータブルデータ**: データ更新時に新しいオブジェクトを作成
4. **サーバーレスアーキテクチャ**: インフラストラクチャ管理を簡素化

## データフロー
1. ユーザーがフロントエンドでアクションを実行（例：新しいTODOの作成）
2. フロントエンドのuseTodosフックが対応するAPIエンドポイントを呼び出す
3. リクエストがAPI Gatewayを通じてLambda関数に転送される
4. Lambda関数がリクエストを処理し、データストアを更新
5. レスポンスがAPI Gatewayを通じてフロントエンドに返される
6. フロントエンドがレスポンスに基づいて状態を更新し、UIを再レンダリング

## 技術的決定
1. **Next.js**: Reactベースのフレームワークで、パフォーマンスとSEO最適化を提供
2. **Hono**: 軽量で高速なWebフレームワークで、TypeScriptのサポートが優れている
3. **AWS Lambda**: サーバーレスでスケーラブルなバックエンド実行環境
4. **AWS CDK**: インフラストラクチャをコードとして定義し、デプロイを自動化
5. **TypeScript**: 型安全性を提供し、開発時のエラーを減少させる
6. **Tailwind CSS**: ユーティリティファーストのCSSフレームワークで、カスタムデザインを効率的に実装

## 制約と考慮事項
1. **メモリ内データストア**: 現在のバージョンではデータが永続化されていないため、Lambda関数が再起動するとデータが失われる
2. **CORS設定**: フロントエンドとバックエンドが異なるドメインで実行される場合のクロスオリジンリクエスト
3. **Lambda Cold Start**: 初回実行時のレイテンシ増加の可能性
4. **API Gateway制限**: リクエスト数やペイロードサイズの制限